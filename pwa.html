<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chef Pilot - Inventaire Mobile</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f7f7f7;
      color: #333;
    }
    header {
      background: #cd160f;
      color: white;
      text-align: center;
      padding: 14px;
      font-size: 20px;
      font-weight: bold;
    }
    main {
      padding: 16px;
    }
    h2 {
      margin-top: 0;
    }
    .produit {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      margin: 8px 0;
      background: white;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .produit input {
      width: 70px;
      padding: 4px;
      font-size: 14px;
    }
    button {
      display: block;
      width: 100%;
      padding: 14px;
      margin-top: 20px;
      background: #cd160f;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    button:active {
      background: #a3120a;
    }
  </style>
</head>
<body>
  <header>Inventaire - Chef Pilot</header>
  <main>
    <h2 id="emp"></h2>
    <div id="liste"></div>
    <button onclick="envoyer()">Envoyer les quantités</button>
  </main>

  <script>
    const API = "https://script.google.com/macros/s/AKfycby-HKEw-pf8l3Bgnf_YJzTNNbSMwn5bbUNYGc_TJUKcpl_U73-COrPB9y8nBPRHGsP8HQ/exec";

    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");
    const emp = params.get("emp");

    document.getElementById("emp").textContent = emp ? "Emplacement : " + emp : "";

    async function charger() {
      const r = await fetch(API + "?action=poll&token=" + token);
      const data = await r.json();
      if (data && data.items) {
        const liste = document.getElementById("liste");
        liste.innerHTML = "";
        data.items.forEach(p => {
          const div = document.createElement("div");
          div.className = "produit";
          div.innerHTML = `
            <span>${p.Produit} (${p.Format})</span>
            <input type="number" step="0.001" placeholder="Qté">
          `;
          liste.appendChild(div);
        });
      }
    }

    async function envoyer() {
      const divs = document.querySelectorAll(".produit");
      const entries = [];
      divs.forEach(d => {
        const nom = d.querySelector("span").textContent.split(" (")[0];
        const qte = d.querySelector("input").value;
        if (qte !== "") {
          entries.push({Produit: nom, Quantite: qte});
        }
      });
      await fetch(API + "?action=submit&token=" + token, {
        method: "POST",
        body: JSON.stringify(entries),
      });
      alert("Inventaire envoyé ✅");
    }

    charger();
  </script>
</body>
</html>
